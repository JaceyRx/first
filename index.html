<!DOCTYPE html>
<html>
<head>
	<title>矩阵设置</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- 引入bootstrap -->
	<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
	<script src="js/jquery-3.1.1.js"></script>
	<script src="js/bootstrap.js"></script>

	<style type="text/css">
		body {background: #eeeaea }
		.a {
			/*border:1px solid #000; */
			/*height: 500px;*/
		}
		.fileDiv{
			width: 100px;
			height: 100px;
		  float:left;
		  text-align:center;
		  line-height:100px;
		  font-size:12px;
		  border:1px solid #ccc;
		  /*margin:2px;*/
		}
		.seled{border:1px solid red;background-color:#D6DFF7;}  
	
	</style>


</head>
<body>
	<div class="container"  style="background: #fff; padding-top: 20px; ">
	   <div class="row">
	      <!-- 左边 -->
	      <div class="col-md-4 a" >
			<ul id="myTab" class="nav nav-tabs">
				<li class="active"><a href="#av" data-toggle="tab">AV矩阵</a></li>
				<li><a href="#vga" data-toggle="tab">VGA矩阵</a></li>
				<li><a href="#dvi" data-toggle="tab">DVI矩阵</a></li>
			</ul>
			<div id="myTabContent" class="tab-content">
				<div class="tab-pane fade in active" id="av">
					<div class="panel panel-default" style="margin-top: 10px;">
					    <div class="panel-body">
					        <form class="form-horizontal" role="form">
								<div class="form-group">
									<label class="col-sm-4 control-label">矩阵厂家</label>
									<div class="col-sm-8">
										<select class="form-control">
									      <option>1</option>
									      <option>2</option>
									      <option>3</option>
									      <option>4</option>
									      <option>5</option>
									    </select>
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-4 control-label">命令延时</label>
									<div class="col-sm-8">
										<select class="form-control">
									      <option>1</option>
									      <option>2</option>
									      <option>3</option>
									      <option>4</option>
									      <option>5</option>
									    </select>
									</div>
								</div>
								<div class="form-group" style="text-align: center;">
									<button class="btn btn-success">设置矩阵输入名</button>
								</div>
							</form>
					    </div>
					</div>
				</div>
				<div class="tab-pane fade" id="vga">
					<div class="panel panel-default" style="margin-top: 10px;">
					    <div class="panel-body">
					        <form class="form-horizontal" role="form">
								<div class="form-group">
									<label class="col-sm-4 control-label">矩阵厂家</label>
									<div class="col-sm-8">
										<select class="form-control">
									      <option>1</option>
									      <option>2</option>
									      <option>3</option>
									      <option>4</option>
									      <option>5</option>
									    </select>
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-4 control-label">输入总数</label>
									<div class="col-sm-8">
										<select class="form-control">
									      <option>1</option>
									      <option>2</option>
									      <option>3</option>
									      <option>4</option>
									      <option>5</option>
									    </select>
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-4 control-label">设备地址</label>
									<div class="col-sm-8">
										<select class="form-control">
									      <option>1</option>
									      <option>2</option>
									      <option>3</option>
									      <option>4</option>
									      <option>5</option>
									    </select>
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-4 control-label">命令延时</label>
									<div class="col-sm-8">
										<select class="form-control">
									      <option>1</option>
									      <option>2</option>
									      <option>3</option>
									      <option>4</option>
									      <option>5</option>
									    </select>
									</div>
								</div>
								<div class="form-group" style="text-align: center;">
									<button class="btn btn-success">设置矩阵输入名</button>
								</div>
							</form>
					    </div>
					</div>
				</div>
				<div class="tab-pane fade" id="dvi">
					<div class="panel panel-default" style="margin-top: 10px;">
					    <div class="panel-body">
					        <form class="form-horizontal" role="form">
								<div class="form-group">
									<label class="col-sm-4 control-label">矩阵厂家</label>
									<div class="col-sm-8">
										<select class="form-control">
									      <option>1</option>
									      <option>2</option>
									      <option>3</option>
									      <option>4</option>
									      <option>5</option>
									    </select>
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-4 control-label">命令延时</label>
									<div class="col-sm-8">
										<select class="form-control">
									      <option>1</option>
									      <option>2</option>
									      <option>3</option>
									      <option>4</option>
									      <option>5</option>
									    </select>
									</div>
								</div>
								<div class="form-group" style="text-align: center;">
									<button class="btn btn-success">设置矩阵输入名</button>
								</div>
							</form>
					    </div>
					</div>
				</div>
			</div>
			<!-- <div style="border:1px solid #f0f0f0; margin-bottom:15px;  "></div> -->
			<div style="text-align: center;">		
				<button class="btn btn-primary">确认</button>
				<button class="btn btn-danger">关闭</button>
			</div>
			</div>	      	
	      <!-- 右边 -->
	      <div class="col-md-8 a" >
	      	<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title">矩阵输出连接示意图</h3>
				</div>
				<div class="panel-body">
					<form class="form-inline" role="form">
						<div class="form-group">
							<label class="" for="name">拼接盒输出通道</label>
							<select class="form-control" id="name">
						      <option>1</option>
						      <option>2</option>
						      <option>3</option>
						      <option>4</option>
						      <option>5</option>
						    </select>
						</div>
						<div class="form-group pull-right">
							<button class="btn btn-danger btn-sm">取消所有连接</button>
							<button class="btn btn-info btn-sm">一对一接法</button>
							
						      
    
						</div>
					</form>
					<h4>矩阵与拼接连盒连接设置</h4>
					<div class="box">
					  <div class="fileDiv">file1</div> 
				      <div class="fileDiv">file2</div> 
				      <div class="fileDiv">file3</div> 
				      <div class="fileDiv">file4</div> 
				      <div class="fileDiv">file5</div> 
				      <div class="fileDiv">file6</div> 
				      <div class="fileDiv">file7</div> 
				      <div class="fileDiv">file8</div> 
				      <div class="fileDiv">file9</div> 
				      <div class="fileDiv">file10</div> 
				      <div class="fileDiv">file11</div> 
				      <div class="fileDiv">file12</div> 
				      <div class="fileDiv">file13</div> 
				      <div class="fileDiv">file14</div> 
				      <div class="fileDiv">file15</div> 
				      <div class="fileDiv">file16</div> 
				      <div class="fileDiv">file17</div> 
				      <div class="fileDiv">file18</div> 
				      <div class="fileDiv">file19</div> 
				      <div class="fileDiv">file20</div> 
				      <div class="fileDiv">file21</div> 
				      <div class="fileDiv">file22</div> 
				      <div class="fileDiv">file23</div> 
				      <div class="fileDiv">file24</div> 
				      <div class="fileDiv">file26</div>
				      <div class="fileDiv">file27</div> 
				      <div class="fileDiv">file28</div> 
				      <div class="fileDiv">file29</div> 
					</div>
				</div>
			</div>
	      </div>      
	   </div>
	</div>
	<!-- <div>
		<p>选择框与left的距离：<span id="l"></span><br />
		<p>选择框与top的距离：<span id="t"></span><br />
		<p>选择框的 width ：<span id="w"></span><br />
		<p>选择框的 height ：<span id="h"></span><br />

		<p>小方块与left的距离+width：<span id="sl"></span><br />
		<p>小方块与top的距离+height：<span id="st"></span><br />
		<p>小方块与left的距离：<span id="ssl"></span><br />
		<p>小方块与top的距离：<span id="sst"></span><br />
		<!-- <p>小方块的 width ：<span id="w"></span><br />
		<p>小方块的 height ：<span id="h"></span><br />
	</div> -->
</body>
<script type="text/javascript">
	// 选择实现
	(function() { 

		var inBox = false;
		$(".box").mouseenter(function() {
			inBox = true;
		});
		$(".box").mouseleave(function() {
			inBox = false;
		}); 

	  document.onmousedown = function() { 

	  	var isSelect = false;
		if (inBox) {
		  isSelect = true;
		}
		if (!isSelect) {
		  return;
		}

	    var selList = []; 

	    var fileNodes = document.getElementsByTagName("div"); 

	    for ( var i = 0; i < fileNodes.length; i++) { 

	      if (fileNodes[i].className.indexOf("fileDiv") != -1) { 

	        fileNodes[i].className = "fileDiv"; 

	        selList.push(fileNodes[i]); 

	      } 

	    } 

	    

	    var evt = window.event || arguments[0]; 

	    var startX = (evt.x || evt.clientX); 

	    var startY = (evt.y || evt.clientY); 

	    var selDiv = document.createElement("div"); 

	    selDiv.style.cssText = "position:absolute;width:0px;height:0px;font-size:0px;margin:0px;padding:0px;border:1px dashed #0099FF;background-color:#C3D5ED;z-index:1000;filter:alpha(opacity:60);opacity:0.6;display:none;"; 

	    selDiv.id = "selectDiv"; 

	    document.body.appendChild(selDiv); 

	    selDiv.style.left = startX + "px"; 

	    selDiv.style.top = startY + "px"; 

	    var _x = null; 

	    var _y = null; 

	    clearEventBubble(evt); 

	    document.onmousemove = function() { 

	      evt = window.event || arguments[0]; 

	      if (isSelect) { 

	        if (selDiv.style.display == "none") { 

	          selDiv.style.display = ""; 

	        } 

	        _x = (evt.x || evt.clientX); 

	        _y = (evt.y || evt.clientY); 

	        selDiv.style.left = Math.min(_x, startX) + "px"; 

	        selDiv.style.top = Math.min(_y, startY) + "px"; 

	        selDiv.style.width = Math.abs(_x - startX) + "px"; 

	        selDiv.style.height = Math.abs(_y - startY) + "px"; 

	        // ---------------- 关键算法 ---------------------  

	        // offset 返回该选择框 在页面中的定位，和其宽高
	        var _l = selDiv.offsetLeft, _t = selDiv.offsetTop; 

	        var _w = selDiv.offsetWidth, _h = selDiv.offsetHeight; 

	        for ( var i = 0; i < selList.length; i++) { 

	          var sl = $(selList[i]).width() + $(selList[i]).offset().left;

	          var st = $(selList[i]).height() + $(selList[i]).position().top;

	   //        	$("#l").text(_l);
				// $("#t").text(_t);
				// $("#w").text(_w);
				// $("#h").text(_h);
				



	          if (sl > _l && st > _t && $(selList[i]).offset().left < _l + _w && $(selList[i]).offset().top < _t + _h) {
	          	
	   //        	$("#sl").text(sl);
				// $("#st").text(st);
				// $("#ssl").text($(selList[i]).offset().left);
				// $("#sst").text($(selList[i]).offset().top);

	            if (selList[i].className.indexOf("seled") == -1) { 

	              selList[i].className = selList[i].className + " seled"; 

	            } 

	          } else { 

	            if (selList[i].className.indexOf("seled") != -1) { 

	              selList[i].className = "fileDiv"; 

	            } 

	          } 

	        } 

	      } 

	      clearEventBubble(evt); 

	    } 

	    document.onmouseup = function() { 

	      isSelect = false; 

	      if (selDiv) { 

	        document.body.removeChild(selDiv); 

	        showSelDiv(selList); 

	      } 

	      selList = null, _x = null, _y = null, selDiv = null, startX = null, startY = null, evt = null; 

	    } 

	  } 

	})(); 

	// 清除选择框  
	function clearEventBubble(evt) { 

	  if (evt.stopPropagation) 

	    evt.stopPropagation(); 

	  else 

	    evt.cancelBubble = true; 

	  if (evt.preventDefault) 

	    evt.preventDefault(); 

	  else 

	    evt.returnValue = false; 
	} 

	function showSelDiv(arr) { 

	  var count = 0; 

	  var sel_json = []
	  var selInfo = {"name":[]};   

	  for ( var i = 0; i < arr.length; i++) { 

	    if (arr[i].className.indexOf("seled") != -1) { 

	      selInfo.name.push(arr[i].innerHTML);
	      
	    } 

	  } 
	  sel_json.push(selInfo)
	  alert(JSON.stringify(sel_json)) 

	} 
</script>
</html>